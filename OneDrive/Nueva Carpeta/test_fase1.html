<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Testing FASE 1 - SidebarSemana3Module</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            color: #34495e;
            margin-top: 30px;
        }
        .test-section {
            background: #ecf0f1;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #3498db;
            border-radius: 4px;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
        }
        .success {
            background: #d4edda;
            border: 1px solid #28a745;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #dc3545;
            color: #721c24;
        }
        .info {
            background: #d1ecf1;
            border: 1px solid #0c5460;
            color: #0c5460;
        }
        .console-output {
            background: #1e1e1e;
            color: #00ff00;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            margin: 10px 0;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px 5px 5px 0;
        }
        button:hover {
            background: #2980b9;
        }
        .timestamp {
            color: #7f8c8d;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Testing FASE 1 - SidebarSemana3Module</h1>
        <p class="timestamp">Iniciado: <span id="startTime"></span></p>

        <div class="test-section">
            <h2>0Ô∏è‚É£ Verificaci√≥n de Dependencias ANTES de m√≥dulo</h2>
            <div id="test0"></div>
            <button onclick="testDependenciesAvailable()">Verificar Dependencias</button>
        </div>

        <div class="test-section">
            <h2>1Ô∏è‚É£ Verificaci√≥n de M√≥dulo</h2>
            <div id="test1"></div>
            <button onclick="testModuleLoaded()">Ejecutar Test 1</button>
        </div>

        <div class="test-section">
            <h2>2Ô∏è‚É£ Verificaci√≥n de API</h2>
            <div id="test2"></div>
            <button onclick="testAPIAvailable()">Ejecutar Test 2</button>
        </div>

        <div class="test-section">
            <h2>3Ô∏è‚É£ Obtener Estado</h2>
            <div id="test3"></div>
            <button onclick="testGetStatus()">Ejecutar Test 3</button>
        </div>

        <div class="test-section">
            <h2>4Ô∏è‚É£ Validar Dependencias</h2>
            <div id="test3b"></div>
            <button onclick="testValidateDeps()">Ejecutar Test 4</button>
        </div>

        <div class="test-section">
            <h2>5Ô∏è‚É£ Test: abrirAnalisis()</h2>
            <div id="test4"></div>
            <button onclick="testAbrirAnalisis()">Ejecutar Test 5</button>
        </div>

        <div class="test-section">
            <h2>6Ô∏è‚É£ Test: abrirMetricas()</h2>
            <div id="test5"></div>
            <button onclick="testAbrirMetricas()">Ejecutar Test 6</button>
        </div>

        <div class="test-section">
            <h2>7Ô∏è‚É£ Test: abrirOptimizacion()</h2>
            <div id="test6"></div>
            <button onclick="testAbrirOptimizacion()">Ejecutar Test 7</button>
        </div>

        <div class="test-section">
            <h2>üìã Consola Capturada</h2>
            <div class="console-output" id="console"></div>
        </div>

        <div class="test-section">
            <h2>Resumen Final</h2>
            <button onclick="runAllTests()">üöÄ Ejecutar TODOS los tests</button>
            <button onclick="clearResults()">üîÑ Limpiar resultados</button>
            <div id="summary" style="margin-top: 20px;"></div>
        </div>
    </div>

    <script>
        let consoleOutput = [];
        let testResults = {};

        // Capturar console.log
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            const msg = args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            consoleOutput.push(msg);
            updateConsole();
        };

        function updateConsole() {
            const consoleDiv = document.getElementById('console');
            consoleDiv.textContent = consoleOutput.join('\n');
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }

        // Test 0: Verificar dependencias disponibles
        function testDependenciesAvailable() {
            console.log('[TEST 0] Verificando dependencias globales necesarias...');
            const deps = {
                'ModuleManager': typeof ModuleManager !== 'undefined',
                'AnalizadorConflictos': typeof AnalizadorConflictos !== 'undefined',
                'MetricasModule': typeof MetricasModule !== 'undefined',
                'OptimizadorTurnos': typeof OptimizadorTurnos !== 'undefined',
                'AppState': typeof AppState !== 'undefined',
                'NotificationSystem': typeof NotificationSystem !== 'undefined',
                'empleados': typeof empleados !== 'undefined',
                'document.getElementById("modalSemana3")': !!document.getElementById('modalSemana3')
            };

            console.log('[TEST 0] Resultados:', deps);
            
            const missing = Object.entries(deps)
                .filter(([_, available]) => !available)
                .map(([name, _]) => name);

            if (missing.length === 0) {
                console.log('[TEST 0] ‚úÖ Todas las dependencias disponibles');
                document.getElementById('test0').innerHTML = resultHTML(true,
                    'Todas las dependencias disponibles',
                    `<pre>${JSON.stringify(deps, null, 2)}</pre>`
                );
            } else {
                console.warn('[TEST 0] ‚ö†Ô∏è Dependencias faltantes:', missing);
                document.getElementById('test0').innerHTML = resultHTML(false,
                    `Faltantes: ${missing.join(', ')}`,
                    `<pre>${JSON.stringify(deps, null, 2)}</pre>`
                );
            }
        }

        function updateConsole() {
            const consoleDiv = document.getElementById('console');
            consoleDiv.textContent = consoleOutput.join('\n');
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }

        function resultHTML(success, message, details = '') {
            const className = success ? 'success' : 'error';
            const icon = success ? '‚úÖ' : '‚ùå';
            let html = `<div class="test-result ${className}">${icon} ${message}`;
            if (details) {
                html += `<div style="margin-top: 10px; font-size: 12px;">${details}</div>`;
            }
            html += '</div>';
            return html;
        }

        // Test 1: Module loaded
        function testModuleLoaded() {
            console.log('[TEST 1] Verificando si SidebarSemana3Module est√° cargado...');
            try {
                const module = ModuleManager.get('SidebarSemana3Module');
                if (module) {
                    console.log('[TEST 1] ‚úÖ M√≥dulo encontrado en ModuleManager');
                    document.getElementById('test1').innerHTML = resultHTML(true, 
                        'SidebarSemana3Module cargado correctamente',
                        'M√≥dulo disponible en: ModuleManager.get("SidebarSemana3Module")'
                    );
                    testResults.test1 = true;
                } else {
                    throw new Error('ModuleManager.get devolvi√≥ null');
                }
            } catch (e) {
                console.error('[TEST 1] ‚ùå Error:', e.message);
                document.getElementById('test1').innerHTML = resultHTML(false, 
                    'Error cargando m√≥dulo',
                    `Error: ${e.message}`
                );
                testResults.test1 = false;
            }
        }

        // Test 2: API Available
        function testAPIAvailable() {
            console.log('[TEST 2] Verificando API p√∫blica del m√≥dulo...');
            try {
                const module = ModuleManager.get('SidebarSemana3Module');
                const publicMethods = ['init', 'abrirAnalisis', 'abrirMetricas', 'abrirOptimizacion', 'obtenerEstado', 'validarDependencias'];
                
                const missing = publicMethods.filter(method => !module[method]);
                
                if (missing.length === 0) {
                    console.log('[TEST 2] ‚úÖ Todas las funciones p√∫blicas disponibles');
                    document.getElementById('test2').innerHTML = resultHTML(true,
                        'API completa disponible',
                        `M√©todos: ${publicMethods.join(', ')}`
                    );
                    testResults.test2 = true;
                } else {
                    throw new Error(`M√©todos faltantes: ${missing.join(', ')}`);
                }
            } catch (e) {
                console.error('[TEST 2] ‚ùå Error:', e.message);
                document.getElementById('test2').innerHTML = resultHTML(false,
                    'Error en API',
                    `Error: ${e.message}`
                );
                testResults.test2 = false;
            }
        }

        // Test 3: Get Status
        function testGetStatus() {
            console.log('[TEST 3] Obteniendo estado del m√≥dulo...');
            try {
                const module = ModuleManager.get('SidebarSemana3Module');
                const status = module.obtenerEstado();
                console.log('[TEST 3] Estado:', status);
                
                document.getElementById('test3').innerHTML = resultHTML(true,
                    'Estado obtenido correctamente',
                    `<pre>${JSON.stringify(status, null, 2)}</pre>`
                );
                testResults.test3 = true;
            } catch (e) {
                console.error('[TEST 3] ‚ùå Error:', e.message);
                document.getElementById('test3').innerHTML = resultHTML(false,
                    'Error obteniendo estado',
                    `Error: ${e.message}`
                );
                testResults.test3 = false;
            }
        }

        // Test 4: Validate Dependencies
        function testValidateDeps() {
            console.log('[TEST 4] Validando dependencias...');
            try {
                const module = ModuleManager.get('SidebarSemana3Module');
                const deps = module.validarDependencias();
                console.log('[TEST 4] Dependencias:', deps);
                
                document.getElementById('test3b').innerHTML = resultHTML(true,
                    'Validaci√≥n de dependencias completada',
                    `<pre>${JSON.stringify(deps, null, 2)}</pre>`
                );
                testResults.test4 = true;
            } catch (e) {
                console.error('[TEST 4] ‚ùå Error:', e.message);
                document.getElementById('test3b').innerHTML = resultHTML(false,
                    'Error validando dependencias',
                    `Error: ${e.message}`
                );
                testResults.test4 = false;
            }
        }

        // Test 5: abrirAnalisis
        function testAbrirAnalisis() {
            console.log('[TEST 5] Llamando a abrirAnalisis()...');
            try {
                const module = ModuleManager.get('SidebarSemana3Module');
                module.abrirAnalisis();
                
                // Verificar que modal existe
                const modal = document.getElementById('modalSemana3');
                if (modal && modal.classList.contains('active')) {
                    console.log('[TEST 5] ‚úÖ Modal abierto correctamente');
                    document.getElementById('test4').innerHTML = resultHTML(true,
                        'abrirAnalisis() ejecutada correctamente',
                        'Modal modal-analisis abierto'
                    );
                    testResults.test5 = true;
                } else {
                    throw new Error('Modal no se abri√≥ correctamente');
                }
            } catch (e) {
                console.error('[TEST 5] ‚ùå Error:', e.message);
                document.getElementById('test4').innerHTML = resultHTML(false,
                    'Error en abrirAnalisis()',
                    `Error: ${e.message}`
                );
                testResults.test5 = false;
            }
        }

        // Test 6: abrirMetricas
        function testAbrirMetricas() {
            console.log('[TEST 6] Llamando a abrirMetricas()...');
            try {
                const module = ModuleManager.get('SidebarSemana3Module');
                module.abrirMetricas();
                
                const modal = document.getElementById('modalSemana3');
                if (modal && modal.classList.contains('active')) {
                    console.log('[TEST 6] ‚úÖ Modal abierto correctamente');
                    document.getElementById('test5').innerHTML = resultHTML(true,
                        'abrirMetricas() ejecutada correctamente',
                        'Modal modal-metricas abierto'
                    );
                    testResults.test6 = true;
                } else {
                    throw new Error('Modal no se abri√≥ correctamente');
                }
            } catch (e) {
                console.error('[TEST 6] ‚ùå Error:', e.message);
                document.getElementById('test5').innerHTML = resultHTML(false,
                    'Error en abrirMetricas()',
                    `Error: ${e.message}`
                );
                testResults.test6 = false;
            }
        }

        // Test 7: abrirOptimizacion
        function testAbrirOptimizacion() {
            console.log('[TEST 7] Llamando a abrirOptimizacion()...');
            try {
                const module = ModuleManager.get('SidebarSemana3Module');
                module.abrirOptimizacion();
                
                const modal = document.getElementById('modalSemana3');
                if (modal && modal.classList.contains('active')) {
                    console.log('[TEST 7] ‚úÖ Modal abierto correctamente');
                    document.getElementById('test6').innerHTML = resultHTML(true,
                        'abrirOptimizacion() ejecutada correctamente',
                        'Modal modal-optimizacion abierto'
                    );
                    testResults.test7 = true;
                } else {
                    throw new Error('Modal no se abri√≥ correctamente');
                }
            } catch (e) {
                console.error('[TEST 7] ‚ùå Error:', e.message);
                document.getElementById('test6').innerHTML = resultHTML(false,
                    'Error en abrirOptimizacion()',
                    `Error: ${e.message}`
                );
                testResults.test7 = false;
            }
        }

        // Run all tests
        function runAllTests() {
            console.log('‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó');
            console.log('‚ïë    INICIANDO SUITE COMPLETA DE TESTS - FASE 1             ‚ïë');
            console.log('‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù');
            
            testDependenciesAvailable();
            setTimeout(() => testModuleLoaded(), 500);
            setTimeout(() => testAPIAvailable(), 1000);
            setTimeout(() => testGetStatus(), 1500);
            setTimeout(() => testValidateDeps(), 2000);
            setTimeout(() => testAbrirAnalisis(), 2500);
            setTimeout(() => testAbrirMetricas(), 3000);
            setTimeout(() => testAbrirOptimizacion(), 3500);
            setTimeout(() => showSummary(), 4000);
        }

        // Clear results
        function clearResults() {
            document.getElementById('test1').innerHTML = '';
            document.getElementById('test2').innerHTML = '';
            document.getElementById('test3').innerHTML = '';
            document.getElementById('test3b').innerHTML = '';
            document.getElementById('test4').innerHTML = '';
            document.getElementById('test5').innerHTML = '';
            document.getElementById('test6').innerHTML = '';
            document.getElementById('summary').innerHTML = '';
            testResults = {};
            consoleOutput = [];
            updateConsole();
        }

        // Show summary
        function showSummary() {
            const total = Object.keys(testResults).length;
            const passed = Object.values(testResults).filter(v => v === true).length;
            const failed = total - passed;
            const percentage = total > 0 ? Math.round((passed / total) * 100) : 0;
            
            let summaryHTML = `
                <div class="test-result ${percentage === 100 ? 'success' : percentage >= 70 ? 'info' : 'error'}">
                    <h3>${percentage === 100 ? 'üéâ TODOS LOS TESTS PASARON' : '‚ö†Ô∏è ALGUNOS TESTS FALLARON'}</h3>
                    <p><strong>Resultados:</strong> ${passed}/${total} tests pasados (${percentage}%)</p>
                    <p><strong>Exitosos:</strong> ${passed} ‚úÖ | <strong>Fallidos:</strong> ${failed} ‚ùå</p>
                    <hr>
                    <p><strong>Tiempo de finalizaci√≥n:</strong> <span id="endTime"></span></p>
                </div>
            `;
            
            document.getElementById('summary').innerHTML = summaryHTML;
            document.getElementById('endTime').textContent = new Date().toLocaleTimeString('es-ES');
        }

        // Initialize
        document.getElementById('startTime').textContent = new Date().toLocaleTimeString('es-ES');
    </script>
</body>
</html>
