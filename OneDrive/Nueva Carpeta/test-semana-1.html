<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tests Semana 1 - Sistema de Turnos</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        h1 {
            color: #667eea;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        .test-section {
            margin: 20px 0;
            border-left: 4px solid #667eea;
            padding-left: 20px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }
        .test-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
            font-size: 16px;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }
        .pass {
            background: #d4edda;
            color: #155724;
            border-left: 3px solid #28a745;
        }
        .fail {
            background: #f8d7da;
            color: #721c24;
            border-left: 3px solid #dc3545;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 3px solid #17a2b8;
        }
        .summary {
            margin-top: 30px;
            padding: 20px;
            background: #e7f3ff;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        .summary h2 {
            color: #667eea;
            margin-top: 0;
        }
        .stat {
            display: inline-block;
            margin-right: 30px;
            font-weight: bold;
        }
        .stat.passed { color: #28a745; }
        .stat.failed { color: #dc3545; }
        .stat.total { color: #667eea; }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚úÖ Tests de Verificaci√≥n - Semana 1</h1>
        <p style="color: #666;">Ejecuci√≥n autom√°tica de 6 tests del sistema de turnos</p>
        
        <div id="results"></div>
        
        <div class="summary">
            <h2>üìä Resumen de Resultados</h2>
            <div class="stat total">Total: <span id="total">0</span></div>
            <div class="stat passed">Pasados: <span id="passed">0</span></div>
            <div class="stat failed">Fallidos: <span id="failed">0</span></div>
        </div>
    </div>

    <script src="js/validador-datos.js"></script>
    <script src="js/auto-save.js"></script>
    <script src="js/tab-sync.js"></script>

    <script>
        // ‚úÖ CREAR VARIABLE GLOBAL empleados PARA TESTS
        if (typeof empleados === 'undefined') {
            window.empleados = [
                { 
                    id: 1, 
                    nombre: 'Juan Garc√≠a', 
                    email: 'juan@test.com', 
                    telefono: '123456789', 
                    horasContrato: 160,
                    departamento: 'Operaciones',
                    estado: 'activo'
                },
                { 
                    id: 2, 
                    nombre: 'Mar√≠a L√≥pez', 
                    email: 'maria@test.com', 
                    telefono: '987654321', 
                    horasContrato: 160,
                    departamento: 'Ventas',
                    estado: 'activo'
                }
            ];
        }

        // ‚úÖ CREAR APPSTATE GLOBAL PARA TESTS
        if (typeof AppState === 'undefined') {
            window.AppState = {
                currentMonth: 0,
                currentYear: 2026,
                scheduleData: new Map(),
                cambiosPendientes: [],
                saveToStorage: function() { console.log('Guardado en storage'); }
            };
        }
        
        const resultsDiv = document.getElementById('results');
        let passedTests = 0;
        let failedTests = 0;
        const tests = [];

        function addTest(title, result, passed) {
            const testDiv = document.createElement('div');
            testDiv.className = 'test-section';
            
            const titleDiv = document.createElement('div');
            titleDiv.className = 'test-title';
            titleDiv.textContent = title;
            
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${passed ? 'pass' : 'fail'}`;
            resultDiv.textContent = JSON.stringify(result, null, 2);
            
            testDiv.appendChild(titleDiv);
            testDiv.appendChild(resultDiv);
            resultsDiv.appendChild(testDiv);
            
            if (passed) {
                passedTests++;
            } else {
                failedTests++;
            }
            
            tests.push({ title, passed, result });
        }

        // Test 1: Validador de Datos - Empleado v√°lido
        try {
            const result1 = ValidadorDatos.validarEmpleado({
                nombre: 'Juan Garc√≠a',
                email: 'juan@test.com',
                telefono: '123456789',
                horasContrato: 160,
                departamento: 'Operaciones',
                estado: 'activo'
            });
            const passed1 = result1.valido === true && result1.errores.length === 0;
            addTest('Test 1: Validador - Empleado V√°lido', result1, passed1);
        } catch (e) {
            addTest('Test 1: Validador - Empleado V√°lido', { error: e.message }, false);
        }

        // Test 2: Validador de Datos - Empleado inv√°lido (email vac√≠o)
        try {
            const result2 = ValidadorDatos.validarEmpleado({
                nombre: 'Juan Garc√≠a',
                email: '',
                telefono: '123456789',
                horasContrato: 160
            });
            const passed2 = result2.valido === false && result2.errores.length > 0;
            addTest('Test 2: Validador - Empleado Inv√°lido (email vac√≠o)', result2, passed2);
        } catch (e) {
            addTest('Test 2: Validador - Empleado Inv√°lido (email vac√≠o)', { error: e.message }, false);
        }

        // Test 3: Auto-Save - Inicializaci√≥n
        try {
            const result3 = {
                isInitialized: AutoSaveManager.isInitialized,
                intervalMs: AutoSaveManager.INTERVAL_MS,
                debounceMs: AutoSaveManager.DEBOUNCE_MS,
                timerExists: AutoSaveManager.timer === null ? 'null (a√∫n no iniciado)' : 'inicializado'
            };
            const passed3 = AutoSaveManager.INTERVAL_MS === 30000 && AutoSaveManager.DEBOUNCE_MS === 500;
            addTest('Test 3: AutoSaveManager - Par√°metros Iniciales', result3, passed3);
        } catch (e) {
            addTest('Test 3: AutoSaveManager - Par√°metros Iniciales', { error: e.message }, false);
        }

        // Test 4: TabSync - Inicializaci√≥n
        try {
            // Inicializar TabSyncManager manualmente
            if (!TabSyncManager.isInitialized) {
                TabSyncManager.init();
            }
            
            const result4 = {
                isInitialized: TabSyncManager.isInitialized,
                tabIdAssigned: TabSyncManager.tabId !== null,
                tabIdValue: TabSyncManager.tabId,
                listeners: TabSyncManager.listeners.length,
                heartbeatExists: TabSyncManager.heartbeatInterval === null ? 'no iniciado' : 'activo'
            };
            const passed4 = typeof TabSyncManager.tabId === 'string' && TabSyncManager.isInitialized === true;
            addTest('Test 4: TabSyncManager - ID y Listeners', result4, passed4);
        } catch (e) {
            addTest('Test 4: TabSyncManager - ID y Listeners', { error: e.message }, false);
        }

        // Test 5: Validador - Validar turno
        try {
            const result5 = {
                validarTurnoMa√±ana: ValidadorDatos.validarTurno({
                    empleadoId: 1,
                    turno: 'ma√±ana',
                    dia: 5,
                    mes: 1,
                    anio: 2026
                }),
                validarTurnoNoche: ValidadorDatos.validarTurno({
                    empleadoId: 1,
                    turno: 'noche',
                    dia: 6,
                    mes: 1,
                    anio: 2026
                }),
                validarTurnoInvalido: ValidadorDatos.validarTurno({
                    empleadoId: 1,
                    turno: 'turno-inexistente',
                    dia: 7,
                    mes: 1,
                    anio: 2026
                })
            };
            const passed5 = result5.validarTurnoMa√±ana.valido === true && 
                           result5.validarTurnoNoche.valido === true && 
                           result5.validarTurnoInvalido.valido === false;
            addTest('Test 5: ValidadorDatos - Validar Turnos', result5, passed5);
        } catch (e) {
            addTest('Test 5: ValidadorDatos - Validar Turnos', { error: e.message }, false);
        }

        // Test 6: Integraci√≥n completa - Estado de m√≥dulos
        try {
            const result6 = {
                validadorCargado: typeof ValidadorDatos === 'function',
                autoSaveCargado: typeof AutoSaveManager === 'function',
                tabSyncCargado: typeof TabSyncManager === 'function',
                metodosValidador: Object.keys(ValidadorDatos).filter(k => typeof ValidadorDatos[k] === 'function').length,
                metodosAutoSave: Object.keys(AutoSaveManager).filter(k => typeof AutoSaveManager[k] === 'function').length,
                metodosTabSync: Object.keys(TabSyncManager).filter(k => typeof TabSyncManager[k] === 'function').length
            };
            const passed6 = result6.validadorCargado && result6.autoSaveCargado && result6.tabSyncCargado;
            addTest('Test 6: Integraci√≥n - Todos los m√≥dulos cargados', result6, passed6);
        } catch (e) {
            addTest('Test 6: Integraci√≥n - Todos los m√≥dulos cargados', { error: e.message }, false);
        }

        // Actualizar resumen
        document.getElementById('total').textContent = passedTests + failedTests;
        document.getElementById('passed').textContent = passedTests;
        document.getElementById('failed').textContent = failedTests;

        // Log en consola
        console.log('=== RESULTADOS DE TESTS SEMANA 1 ===');
        console.log(`Total: ${passedTests + failedTests}`);
        console.log(`Pasados: ${passedTests}`);
        console.log(`Fallidos: ${failedTests}`);
        console.table(tests);
    </script>
</body>
</html>
