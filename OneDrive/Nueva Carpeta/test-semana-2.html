<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tests Semana 2 - Sistema de Turnos</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        h1 {
            color: #667eea;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        .test-section {
            margin: 20px 0;
            border-left: 4px solid #667eea;
            padding-left: 20px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }
        .test-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
            font-size: 16px;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }
        .pass {
            background: #d4edda;
            color: #155724;
            border-left: 3px solid #28a745;
        }
        .fail {
            background: #f8d7da;
            color: #721c24;
            border-left: 3px solid #dc3545;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border-left: 3px solid #17a2b8;
        }
        .summary {
            margin-top: 30px;
            padding: 20px;
            background: #e7f3ff;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        .summary h2 {
            color: #667eea;
            margin-top: 0;
        }
        .stat {
            display: inline-block;
            margin-right: 30px;
            font-weight: bold;
        }
        .stat.passed { color: #28a745; }
        .stat.failed { color: #dc3545; }
        .stat.total { color: #667eea; }
    </style>
</head>
<body>
    <div class="container">
        <h1>âœ… Tests de VerificaciÃ³n - Semana 2</h1>
        <p style="color: #666;">EjecuciÃ³n automÃ¡tica de 6 tests de nuevos mÃ³dulos</p>
        
        <div id="results"></div>
        
        <div class="summary">
            <h2>ðŸ“Š Resumen de Resultados</h2>
            <div class="stat total">Total: <span id="total">0</span></div>
            <div class="stat passed">Pasados: <span id="passed">0</span></div>
            <div class="stat failed">Fallidos: <span id="failed">0</span></div>
        </div>
    </div>

    <script src="js/generador-reportes.js"></script>
    <script src="js/integracion-whatsapp.js"></script>
    <script src="js/sincronizacion-datos.js"></script>

    <script>
        // âœ… CREAR VARIABLE GLOBAL empleados PARA TESTS
        if (typeof empleados === 'undefined') {
            window.empleados = [
                { 
                    id: 1, 
                    nombre: 'Juan GarcÃ­a', 
                    email: 'juan@test.com', 
                    telefono: '645123456', 
                    horasContrato: 160,
                    departamento: 'Operaciones',
                    estado: 'activo'
                },
                { 
                    id: 2, 
                    nombre: 'MarÃ­a LÃ³pez', 
                    email: 'maria@test.com', 
                    telefono: '612345678', 
                    horasContrato: 160,
                    departamento: 'Ventas',
                    estado: 'activo'
                }
            ];
        }

        // âœ… CREAR APPSTATE GLOBAL
        if (typeof AppState === 'undefined') {
            window.AppState = {
                currentMonth: 0,
                currentYear: 2026,
                scheduleData: new Map([
                    [1, [
                        { dia: 1, turno: 'maÃ±ana', mes: 0, anio: 2026, horas: 8 },
                        { dia: 2, turno: 'tarde', mes: 0, anio: 2026, horas: 8 },
                        { dia: 3, turno: 'noche', mes: 0, anio: 2026, horas: 8 },
                        { dia: 4, turno: 'descanso', mes: 0, anio: 2026, horas: 0 },
                        { dia: 5, turno: 'maÃ±ana', mes: 0, anio: 2026, horas: 8 }
                    ]],
                    [2, [
                        { dia: 1, turno: 'tarde', mes: 0, anio: 2026, horas: 8 },
                        { dia: 2, turno: 'noche', mes: 0, anio: 2026, horas: 8 },
                        { dia: 3, turno: 'maÃ±ana', mes: 0, anio: 2026, horas: 8 }
                    ]]
                ]),
                cambiosPendientes: []
            };
        }

        const resultsDiv = document.getElementById('results');
        let passedTests = 0;
        let failedTests = 0;
        const tests = [];

        function addTest(title, result, passed) {
            const testDiv = document.createElement('div');
            testDiv.className = 'test-section';
            
            const titleDiv = document.createElement('div');
            titleDiv.className = 'test-title';
            titleDiv.textContent = title;
            
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${passed ? 'pass' : 'fail'}`;
            resultDiv.textContent = JSON.stringify(result, null, 2);
            
            testDiv.appendChild(titleDiv);
            testDiv.appendChild(resultDiv);
            resultsDiv.appendChild(testDiv);
            
            if (passed) {
                passedTests++;
            } else {
                failedTests++;
            }
            
            tests.push({ title, passed, result });
        }

        // Test 1: GeneradorReportes - Reporte mensual
        try {
            const reporte = GeneradorReportes.generarReporteMensual();
            const passed1 = reporte.totalEmpleados > 0 && 
                           reporte.estadisticas && 
                           typeof reporte.empleados === 'object';
            addTest('Test 1: GeneradorReportes - Reporte Mensual', {
                totalEmpleados: reporte.totalEmpleados,
                empleadosActivos: reporte.empleadosActivos,
                horasTotales: reporte.estadisticas.horasTotales,
                periodo: reporte.periodo
            }, passed1);
        } catch (e) {
            addTest('Test 1: GeneradorReportes - Reporte Mensual', { error: e.message }, false);
        }

        // Test 2: GeneradorReportes - Reporte individual
        try {
            const reporteIndividual = GeneradorReportes.generarReporteEmpleado(1);
            const passed2 = reporteIndividual.empleado && 
                           reporteIndividual.estadisticas && 
                           reporteIndividual.empleado.nombre === 'Juan GarcÃ­a';
            addTest('Test 2: GeneradorReportes - Reporte Individual', {
                empleado: reporteIndividual.empleado.nombre,
                horasTrabajadas: reporteIndividual.estadisticas.horasTrabajadas,
                turnosTotal: reporteIndividual.estadisticas.turnosTotal
            }, passed2);
        } catch (e) {
            addTest('Test 2: GeneradorReportes - Reporte Individual', { error: e.message }, false);
        }

        // Test 3: IntegracionWhatsApp - Validar telÃ©fono
        try {
            const valido1 = IntegracionWhatsApp.validarTelefono('645123456');
            const valido2 = IntegracionWhatsApp.validarTelefono('123'); // Muy corto
            const valido3 = IntegracionWhatsApp.validarTelefono(null); // Nulo
            const passed3 = valido1 === true && valido2 === false && valido3 === false;
            addTest('Test 3: IntegracionWhatsApp - Validar TelÃ©fono', {
                telefonoValido645: valido1,
                telefonoCorto: valido2,
                telefonoNulo: valido3
            }, passed3);
        } catch (e) {
            addTest('Test 3: IntegracionWhatsApp - Validar TelÃ©fono', { error: e.message }, false);
        }

        // Test 4: IntegracionWhatsApp - Formatear telÃ©fono
        try {
            const formatted = IntegracionWhatsApp.formatearTelefonoWhatsApp('645123456');
            const passed4 = formatted && formatted.length >= 10 && formatted.startsWith('34');
            addTest('Test 4: IntegracionWhatsApp - Formatear TelÃ©fono', {
                telefonoFormateado: formatted,
                esValido: passed4,
                tieneCodigo34: formatted ? formatted.startsWith('34') : false
            }, passed4);
        } catch (e) {
            addTest('Test 4: IntegracionWhatsApp - Formatear TelÃ©fono', { error: e.message }, false);
        }

        // Test 5: SincronizacionDatos - Inicializar
        try {
            SincronizacionDatos.init();
            const estado = SincronizacionDatos.obtenerEstadoSync();
            const passed5 = SincronizacionDatos.isInitialized === true && 
                           typeof estado.totalSyncs === 'number';
            addTest('Test 5: SincronizacionDatos - InicializaciÃ³n', {
                isInitialized: SincronizacionDatos.isInitialized,
                totalSyncs: estado.totalSyncs,
                lastSync: estado.lastSync
            }, passed5);
        } catch (e) {
            addTest('Test 5: SincronizacionDatos - InicializaciÃ³n', { error: e.message }, false);
        }

        // Test 6: SincronizacionDatos - Crear backup local
        try {
            const resultado = SincronizacionDatos.crearBackupLocal();
            const passed6 = resultado.exito === true && resultado.bytes > 0;
            addTest('Test 6: SincronizacionDatos - Backup Local', {
                exito: resultado.exito,
                bytes: resultado.bytes,
                destino: resultado.destino
            }, passed6);
        } catch (e) {
            addTest('Test 6: SincronizacionDatos - Backup Local', { error: e.message }, false);
        }

        // Actualizar resumen
        document.getElementById('total').textContent = passedTests + failedTests;
        document.getElementById('passed').textContent = passedTests;
        document.getElementById('failed').textContent = failedTests;

        // Log en consola
        console.log('=== RESULTADOS DE TESTS SEMANA 2 ===');
        console.log(`Total: ${passedTests + failedTests}`);
        console.log(`Pasados: ${passedTests}`);
        console.log(`Fallidos: ${failedTests}`);
        console.table(tests);
    </script>
</body>
</html>
