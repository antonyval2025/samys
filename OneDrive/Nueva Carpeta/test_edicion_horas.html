<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Edici√≥n de Horas</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .output { background: #f8f9fa; padding: 15px; border-radius: 5px; font-family: 'Courier New', monospace; white-space: pre-wrap; max-height: 400px; overflow-y: auto; border: 1px solid #dee2e6; }
        button { padding: 12px 24px; background: linear-gradient(135deg, #007bff 0%, #0056b3 100%); color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin: 5px; }
        button:hover { background: linear-gradient(135deg, #0056b3 0%, #004085 100%); }
        .section { margin: 20px 0; padding: 15px; border-left: 4px solid #007bff; background: #f8f9fa; }
        h1 { color: #333; text-align: center; }
        h2 { color: #007bff; border-bottom: 2px solid #007bff; padding-bottom: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test Edici√≥n de Horas</h1>
        <p>Este test verifica que se puedan editar horas personalizadas como 6.5 o 6.75.</p>

        <div class="section">
            <button onclick="testEditorHoras()">üîç Test Editor con Horas</button>
            <button onclick="verificarHorasGuardadas()">üíæ Verificar Horas Guardadas</button>
            <button onclick="abrirAplicacion()">üì± Abrir Aplicaci√≥n</button>
        </div>

        <h2>Resultado del Test:</h2>
        <div class="output" id="output">Haz clic en "Test Editor con Horas" para comenzar...</div>
    </div>

    <script src="js/modules.js"></script>
    <script>
        // Inicializar empleados con la lista completa
        window.empleados = [
            { id: 1, nombre: "Mar√≠a Rodr√≠guez L√≥pez", localidad: "Madrid", horasContrato: 160 },
            { id: 2, nombre: "Empleado 2", localidad: "Madrid", horasContrato: 160 },
            { id: 3, nombre: "Empleado 3", localidad: "Madrid", horasContrato: 160 },
            { id: 4, nombre: "Empleado 4", localidad: "Madrid", horasContrato: 160 },
            { id: 5, nombre: "Empleado 5", localidad: "Madrid", horasContrato: 160 },
            { id: 6, nombre: "Empleado 6", localidad: "Madrid", horasContrato: 160 },
            { id: 7, nombre: "Empleado 7", localidad: "Madrid", horasContrato: 160 },
            { id: 8, nombre: "antony valencia", localidad: "Madrid", horasContrato: 154 }
        ];

        // Inicializar AppState
        AppState.currentYear = new Date().getFullYear();
        AppState.currentMonth = new Date().getMonth();

        function log(message) {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            output.textContent += `[${timestamp}] ${message}\n`;
            console.log(message);
        }

        function testEditorHoras() {
            document.getElementById('output').textContent = '';
            log('üß™ === TEST EDITOR CON HORAS ===');

            try {
                // Simular apertura del editor para Mar√≠a Rodr√≠guez (ID 1), d√≠a 30
                log('üìù Abriendo editor para Mar√≠a Rodr√≠guez, d√≠a 30...');
                TurnoEditor.abrirEditorTurno(1, 30, 'ma√±ana');

                // Esperar un poco para que se abra el modal
                setTimeout(() => {
                    const selectTurno = document.querySelector('#selectTurno');
                    const inputHoras = document.querySelector('#inputHoras');

                    if (selectTurno && inputHoras) {
                        log('‚úÖ Modal abierto correctamente');
                        log(`üìä Tipo de turno actual: ${selectTurno.value}`);
                        log(`‚è∞ Horas actuales: ${inputHoras.value}`);

                        // Probar cambiar a tarde con horas personalizadas
                        log('üîÑ Cambiando a "tarde" con 6.5 horas...');
                        selectTurno.value = 'tarde';

                        // Simular el cambio autom√°tico de horas
                        const event = new Event('change');
                        selectTurno.dispatchEvent(event);

                        setTimeout(() => {
                            log(`üìä Nuevo tipo de turno: ${selectTurno.value}`);
                            log(`‚è∞ Horas despu√©s del cambio: ${inputHoras.value}`);

                            // Cambiar horas manualmente
                            log('üîÑ Cambiando horas manualmente a 6.75...');
                            inputHoras.value = '6.75';

                            log(`‚è∞ Horas finales: ${inputHoras.value}`);
                            log('‚úÖ Test completado - el editor permite editar horas personalizadas');

                        }, 100);

                    } else {
                        log('‚ùå No se pudo abrir el modal o no se encontraron los elementos');
                    }
                }, 100);

            } catch (error) {
                log(`‚ùå Error en test: ${error.message}`);
            }
        }

        function verificarHorasGuardadas() {
            document.getElementById('output').textContent = '';
            log('üíæ === VERIFICANDO HORAS GUARDADAS ===');

            try {
                const turnosMaria = AppState.scheduleData.get(1);
                if (turnosMaria) {
                    const turno30 = turnosMaria.find(t => t.dia === 30);
                    if (turno30) {
                        log(`üìÖ Mar√≠a Rodr√≠guez - D√≠a 30:`);
                        log(`   Tipo: ${turno30.turno}`);
                        log(`   Horas: ${turno30.horas}`);
                        log(`   Fecha: ${turno30.fecha}`);
                    } else {
                        log('‚ùå No se encontr√≥ turno para el d√≠a 30');
                    }
                } else {
                    log('‚ùå No se encontraron turnos para Mar√≠a Rodr√≠guez');
                }

            } catch (error) {
                log(`‚ùå Error: ${error.message}`);
            }

            log('');
            log('üèÅ === VERIFICACI√ìN COMPLETADA ===');
        }

        function abrirAplicacion() {
            window.open('nuevo_cuadrante_mejorado.html', '_blank');
        }

        // Auto-ejecutar test b√°sico al cargar
        setTimeout(() => {
            if (document.getElementById('output').textContent.includes('Haz clic')) {
                testEditorHoras();
            }
        }, 500);
    </script>
</body>
</html>