<!DOCTYPE html>
<html>
<head>
    <title>DEBUG: TurnoManager Function Check</title>
    <style>
        body { font-family: monospace; background: #1a1a1a; color: #0f0; padding: 20px; }
        .log { margin: 10px 0; padding: 10px; background: #222; border-left: 3px solid #0f0; }
        .error { border-left-color: #f00; color: #f99; }
        .success { border-left-color: #0f0; color: #0f0; }
    </style>
</head>
<body>
    <h1>üîç DEBUG: TurnoManager Function Check</h1>
    <div id="output"></div>

    <script>
        const output = document.getElementById('output');

        function log(msg, type = 'log') {
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.textContent = msg;
            output.appendChild(div);
            console.log(msg);
        }

        // Paso 1: Verificar que el script se ejecut√≥
        log('‚úÖ Este script est√° ejecut√°ndose (1/7)', 'success');

        // Paso 2: Verificar que TurnoManager existe
        if (typeof window.TurnoManager === 'undefined') {
            log('‚ùå ERROR: window.TurnoManager NO existe (2/7)', 'error');
        } else {
            log('‚úÖ window.TurnoManager existe (2/7)', 'success');
        }

        // Paso 3: Listar todas las funciones de TurnoManager
        if (typeof window.TurnoManager === 'object') {
            const keys = Object.keys(window.TurnoManager);
            log(`üìã Funciones en TurnoManager: ${keys.length} encontradas (3/7)`, 'success');
            keys.forEach(key => {
                const type = typeof window.TurnoManager[key];
                const status = type === 'function' ? '‚úÖ' : '‚ö†Ô∏è';
                log(`   ${status} ${key}: ${type}`, type === 'function' ? 'success' : 'error');
            });
        }

        // Paso 4: Verificar espec√≠ficamente mostrarModalGeneracion
        if (typeof window.TurnoManager.mostrarModalGeneracion === 'function') {
            log('‚úÖ window.TurnoManager.mostrarModalGeneracion EXISTE y es una funci√≥n (4/7)', 'success');
        } else {
            log(`‚ùå window.TurnoManager.mostrarModalGeneracion: ${typeof window.TurnoManager.mostrarModalGeneracion} (4/7)`, 'error');
        }

        // Paso 5: Cargar el archivo HTML principal
        log('‚è≥ Cargando nuevo_cuadrante_mejorado.html... (5/7)', 'log');

        fetch('nuevo_cuadrante_mejorado.html')
            .then(r => r.text())
            .then(html => {
                // Buscar definiciones en el HTML
                const defCount = (html.match(/window\.TurnoManager\.\w+\s*=/g) || []).length;
                log(`üìä Definiciones encontradas en HTML: ${defCount} (6/7)`, 'success');

                const hasModal = html.includes('window.TurnoManager.mostrarModalGeneracion');
                if (hasModal) {
                    log('‚úÖ mostrarModalGeneracion EST√Å DEFINIDA en HTML (6/7)', 'success');
                } else {
                    log('‚ùå mostrarModalGeneracion NO EST√Å en HTML (6/7)', 'error');
                }

                // Buscar el bot√≥n
                const btnPattern = /onclick="TurnoManager\.mostrarModalGeneracion\(\)"/;
                if (btnPattern.test(html)) {
                    log('‚úÖ Bot√≥n con onclick correcto ENCONTRADO en HTML (7/7)', 'success');
                } else {
                    log('‚ùå Bot√≥n NO encontrado o tiene onclick incorrecto (7/7)', 'error');
                }

                // Resultado final
                log('\n========== CONCLUSI√ìN ==========', 'log');
                if (typeof window.TurnoManager.mostrarModalGeneracion === 'function' && hasModal && btnPattern.test(html)) {
                    log('üü¢ TODO EST√Å BIEN - El problema puede ser CACHE del navegador', 'success');
                    log('SOLUCI√ìN: Presiona Ctrl+Shift+R para limpiar cache completamente', 'success');
                } else {
                    log('üî¥ PROBLEMA DETECTADO - Ver arriba para detalles', 'error');
                }
            })
            .catch(e => {
                log(`‚ùå Error cargando archivo: ${e.message}`, 'error');
            });
    </script>
</body>
</html>
