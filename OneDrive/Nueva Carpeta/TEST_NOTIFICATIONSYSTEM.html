<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test NotificationSystem</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 { color: #2196F3; }
        button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        button:hover { background: #1976D2; }
        .log {
            background: #f9f9f9;
            border: 1px solid #ddd;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
            word-wrap: break-word;
            max-height: 400px;
            overflow-y: auto;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test de NotificationSystem</h1>
        
        <h3>Cargar aplicaci√≥n e inyectar NotificationSystem</h3>
        <button onclick="cargarAplicacion()">üìÅ Cargar nuevo_cuadrante_mejorado.html</button>
        
        <h3>Tests disponibles (despu√©s de cargar)</h3>
        <button onclick="testExistencia()">‚úÖ Test 1: Verificar existencia</button>
        <button onclick="testMostrarHistorial()">üìã Test 2: mostrarHistorial()</button>
        <button onclick="testShow()">üîî Test 3: show()</button>
        <button onclick="testMetodos()">üîç Test 4: Listar todos los m√©todos</button>
        <button onclick="testDiagnostico()">üìä Test 5: Diagn√≥stico completo</button>
        <button onclick="limpiarLog()">üßπ Limpiar log</button>
        
        <h3>Salida:</h3>
        <div id="log" class="log">
            Haz clic en los botones para ejecutar tests...
        </div>
    </div>

    <script>
        const logDiv = document.getElementById('log');
        
        function escribirLog(texto, tipo = 'info') {
            const timestamp = new Date().toLocaleTimeString('es-ES');
            const mensaje = `[${timestamp}] ${texto}`;
            
            if (logDiv.textContent === 'Haz clic en los botones para ejecutar tests...') {
                logDiv.textContent = '';
            }
            
            const linea = document.createElement('div');
            linea.className = tipo;
            linea.textContent = mensaje;
            logDiv.appendChild(linea);
            logDiv.scrollTop = logDiv.scrollHeight;
        }
        
        function limpiarLog() {
            logDiv.innerHTML = 'Haz clic en los botones para ejecutar tests...';
        }
        
        function cargarAplicacion() {
            escribirLog('üìÅ Cargando nuevo_cuadrante_mejorado.html...', 'info');
            
            // Crear un iframe para cargar la aplicaci√≥n sin contaminar el scope global
            let frame = document.getElementById('appFrame');
            if (frame) frame.remove();
            
            frame = document.createElement('iframe');
            frame.id = 'appFrame';
            frame.src = 'nuevo_cuadrante_mejorado.html';
            frame.style.display = 'none';
            document.body.appendChild(frame);
            
            frame.onload = function() {
                escribirLog('‚úÖ Aplicaci√≥n cargada en iframe', 'success');
                escribirLog('‚ÑπÔ∏è NotificationSystem debe estar disponible en window del iframe', 'info');
                
                // Intentar acceder a NotificationSystem del iframe
                try {
                    const appWindow = frame.contentWindow;
                    if (appWindow.NotificationSystem) {
                        escribirLog(`‚úÖ NotificationSystem accesible desde iframe`, 'success');
                        escribirLog(`üìã M√©todos disponibles: ${Object.keys(appWindow.NotificationSystem).filter(k => typeof appWindow.NotificationSystem[k] === 'function').join(', ')}`, 'success');
                    } else {
                        escribirLog(`‚ùå NotificationSystem no encontrado en iframe`, 'error');
                    }
                } catch (e) {
                    escribirLog(`‚ö†Ô∏è No se puede acceder al iframe (CORS): ${e.message}`, 'error');
                    escribirLog('‚ÑπÔ∏è Abre la aplicaci√≥n directamente en una pesta√±a nueva en su lugar', 'info');
                }
            };
            
            frame.onerror = function() {
                escribirLog('‚ùå Error al cargar el archivo', 'error');
            };
        }
        
        function testExistencia() {
            escribirLog('üîç Test 1: Verificar existencia de NotificationSystem...', 'info');
            
            try {
                if (typeof window.NotificationSystem === 'undefined') {
                    escribirLog('‚ùå window.NotificationSystem NO EXISTE', 'error');
                } else {
                    escribirLog(`‚úÖ window.NotificationSystem existe (tipo: ${typeof window.NotificationSystem})`, 'success');
                }
            } catch (e) {
                escribirLog(`‚ùå Error: ${e.message}`, 'error');
            }
        }
        
        function testMostrarHistorial() {
            escribirLog('üìã Test 2: Ejecutar mostrarHistorial()...', 'info');
            
            try {
                if (typeof window.NotificationSystem.mostrarHistorial !== 'function') {
                    escribirLog('‚ùå mostrarHistorial NO es una funci√≥n', 'error');
                    escribirLog(`Tipo encontrado: ${typeof window.NotificationSystem.mostrarHistorial}`, 'error');
                } else {
                    escribirLog('‚úÖ mostrarHistorial es una funci√≥n', 'success');
                    const resultado = window.NotificationSystem.mostrarHistorial();
                    escribirLog(`‚úÖ Retorn√≥: ${JSON.stringify(resultado)}`, 'success');
                }
            } catch (e) {
                escribirLog(`‚ùå Error al ejecutar: ${e.message}`, 'error');
            }
        }
        
        function testShow() {
            escribirLog('üîî Test 3: Ejecutar show()...', 'info');
            
            try {
                if (typeof window.NotificationSystem.show !== 'function') {
                    escribirLog('‚ùå show NO es una funci√≥n', 'error');
                } else {
                    escribirLog('‚úÖ show es una funci√≥n', 'success');
                    window.NotificationSystem.show('üß™ Notificaci√≥n de prueba', 'info', 3000);
                    escribirLog('‚úÖ show() ejecutado correctamente', 'success');
                }
            } catch (e) {
                escribirLog(`‚ùå Error: ${e.message}`, 'error');
            }
        }
        
        function testMetodos() {
            escribirLog('üîç Test 4: Listar todos los m√©todos...', 'info');
            
            try {
                const keys = Object.keys(window.NotificationSystem);
                escribirLog(`Total de propiedades: ${keys.length}`, 'info');
                
                keys.forEach(key => {
                    const tipo = typeof window.NotificationSystem[key];
                    const simbolo = tipo === 'function' ? 'üîß' : 'üì¶';
                    escribirLog(`${simbolo} ${key}: ${tipo}`, 'info');
                });
            } catch (e) {
                escribirLog(`‚ùå Error: ${e.message}`, 'error');
            }
        }
        
        function testDiagnostico() {
            escribirLog('üìä Test 5: Diagn√≥stico completo...', 'info');
            escribirLog('‚ïê'.repeat(80), 'info');
            
            try {
                // Existencia
                escribirLog('‚úÖ EXISTENCIA:', 'success');
                escribirLog(`  NotificationSystem: ${typeof window.NotificationSystem}`, 'info');
                
                // M√©todos esperados
                escribirLog('‚úÖ M√âTODOS ESPERADOS:', 'success');
                const metodosEsperados = ['show', 'mostrarHistorial', 'limpiarHistorial', 'cerrarNotificacion', 'activarSonidos', 'desactivarSonidos', 'cambiarPosicion', 'reproducirSonido'];
                metodosEsperados.forEach(m => {
                    const existe = typeof window.NotificationSystem[m] === 'function' ? '‚úÖ' : '‚ùå';
                    escribirLog(`  ${existe} ${m}`, 'info');
                });
                
                // Historial
                escribirLog('‚úÖ HISTORIAL:', 'success');
                escribirLog(`  Array: ${Array.isArray(window.NotificationSystem.historial)}`, 'info');
                escribirLog(`  Elementos: ${window.NotificationSystem.historial.length}`, 'info');
                
            } catch (e) {
                escribirLog(`‚ùå Error: ${e.message}`, 'error');
            }
        }
    </script>
</body>
</html>
