<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Turnos en localStorage</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 1000px;
            margin: 0 auto;
            background: #f5f5f5;
        }
        .section {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #3b82f6;
        }
        .pass {
            color: #10b981;
            font-weight: bold;
        }
        .fail {
            color: #ef4444;
            font-weight: bold;
        }
        .info {
            background: #e0f2fe;
            border-left-color: #0284c7;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        h2 {
            color: #1e293b;
            margin-bottom: 10px;
        }
        pre {
            background: #f1f5f9;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>ðŸ§ª Test - Turnos en localStorage</h1>
    
    <div class="section">
        <h2>1. Verificar localStorage</h2>
        <div id="localStorage-check"></div>
    </div>

    <div class="section">
        <h2>2. Verificar que js/modules.js estÃ¡ cargado</h2>
        <div id="modules-check"></div>
    </div>

    <div class="section">
        <h2>3. Verificar que obtenerOpcionesTurno() usa localStorage</h2>
        <div id="opciones-turno-check"></div>
    </div>

    <div class="section">
        <h2>4. Crear turnos de prueba en localStorage</h2>
        <div id="create-turnos"></div>
    </div>

    <div class="section">
        <h2>5. Verificar que los turnos aparecen en obtenerOpcionesTurno()</h2>
        <div id="final-check"></div>
    </div>

    <script src="js/modules.js"></script>
    <script>
        // 1. Verificar localStorage
        function checkLocalStorage() {
            const div = document.getElementById('localStorage-check');
            let html = '';
            
            const tiposTurnoData = localStorage.getItem('tiposTurnoData');
            if (tiposTurnoData) {
                const turnos = JSON.parse(tiposTurnoData);
                html += `<p class="pass">âœ“ tiposTurnoData en localStorage</p>`;
                html += `<pre>${JSON.stringify(turnos, null, 2)}</pre>`;
            } else {
                html += `<p class="fail">âœ— tiposTurnoData NO encontrado en localStorage</p>`;
            }
            
            div.innerHTML = html;
        }

        // 2. Verificar modules.js
        function checkModules() {
            const div = document.getElementById('modules-check');
            let html = '';
            
            try {
                if (typeof TurnoManager !== 'undefined') {
                    html += `<p class="pass">âœ“ TurnoManager cargado</p>`;
                } else {
                    html += `<p class="fail">âœ— TurnoManager NO cargado</p>`;
                }
                
                if (typeof TurnoManager.obtenerOpcionesTurno === 'function') {
                    html += `<p class="pass">âœ“ obtenerOpcionesTurno() existe</p>`;
                } else {
                    html += `<p class="fail">âœ— obtenerOpcionesTurno() NO existe</p>`;
                }
                
                if (typeof EmployeeManager !== 'undefined' && typeof EmployeeManager.llenarSelectTurnos === 'function') {
                    html += `<p class="pass">âœ“ EmployeeManager.llenarSelectTurnos() existe</p>`;
                } else {
                    html += `<p class="fail">âœ— EmployeeManager.llenarSelectTurnos() NO existe</p>`;
                }
            } catch (e) {
                html += `<p class="fail">Error: ${e.message}</p>`;
            }
            
            div.innerHTML = html;
        }

        // 3. Verificar obtenerOpcionesTurno sin cambios
        function checkOpciones() {
            const div = document.getElementById('opciones-turno-check');
            let html = '';
            
            try {
                const opciones = TurnoManager.obtenerOpcionesTurno();
                html += `<p>Opciones actuales: ${opciones.length}</p>`;
                html += `<pre>${JSON.stringify(opciones.slice(0, 3), null, 2)}...</pre>`;
                
                // Verificar que incluya fields correctos
                if (opciones.length > 0 && opciones[0].valor && opciones[0].nombre) {
                    html += `<p class="pass">âœ“ Estructura de opciones es correcta</p>`;
                } else {
                    html += `<p class="fail">âœ— Estructura incorrecta en obtenerOpcionesTurno()</p>`;
                }
            } catch (e) {
                html += `<p class="fail">Error: ${e.message}</p>`;
            }
            
            div.innerHTML = html;
        }

        // 4. Crear turnos de prueba
        function createTestTurnos() {
            const div = document.getElementById('create-turnos');
            let html = '';
            
            try {
                // Crear turnos de prueba
                const testTurnos = {
                    "manana": { 
                        nombre: "MaÃ±ana (test)", 
                        horario: "08:00-16:00", 
                        horas: 8, 
                        color: "#d4edda",
                        inicial: "M"
                    },
                    "tarde": { 
                        nombre: "Tarde (test)", 
                        horario: "14:30-21:00", 
                        horas: 6.5, 
                        color: "#fff3cd",
                        inicial: "T"
                    },
                    "noche": { 
                        nombre: "Noche (test)", 
                        horario: "21:00-05:00", 
                        horas: 8, 
                        color: "#f8d7da",
                        inicial: "N"
                    },
                    "mixto": { 
                        nombre: "Mixto (test)", 
                        horario: "06:00-18:00", 
                        horas: 12, 
                        color: "#e8d4f9",
                        inicial: "X"
                    }
                };
                
                localStorage.setItem('tiposTurnoData', JSON.stringify(testTurnos));
                html += `<p class="pass">âœ“ Turnos de prueba creados en localStorage</p>`;
                html += `<p>Turnos creados: ${Object.keys(testTurnos).length}</p>`;
                html += `<pre>${JSON.stringify(testTurnos, null, 2)}</pre>`;
            } catch (e) {
                html += `<p class="fail">Error: ${e.message}</p>`;
            }
            
            div.innerHTML = html;
        }

        // 5. Verificar que obtenerOpcionesTurno() ahora devuelve los turnos
        function finalCheck() {
            const div = document.getElementById('final-check');
            let html = '';
            
            try {
                const opciones = TurnoManager.obtenerOpcionesTurno();
                html += `<p>Total de opciones despuÃ©s de crear turnos: ${opciones.length}</p>`;
                html += `<h3>Opciones devueltas:</h3>`;
                html += `<pre>${JSON.stringify(opciones, null, 2)}</pre>`;
                
                // Verificar que incluya los turnos de prueba
                const tieneManana = opciones.some(o => o.valor === 'manana');
                const tieneTarde = opciones.some(o => o.valor === 'tarde');
                const tieneNoche = opciones.some(o => o.valor === 'noche');
                const tieneMixto = opciones.some(o => o.valor === 'mixto');
                
                if (tieneManana && tieneTarde && tieneNoche && tieneMixto) {
                    html += `<p class="pass">âœ“ Todos los turnos de prueba estÃ¡n en las opciones</p>`;
                } else {
                    html += `<p class="fail">âœ— Falta algÃºn turno. MaÃ±ana: ${tieneManana}, Tarde: ${tieneTarde}, Noche: ${tieneNoche}, Mixto: ${tieneMixto}</p>`;
                }
                
            } catch (e) {
                html += `<p class="fail">Error: ${e.message}</p>`;
            }
            
            div.innerHTML = html;
        }

        // Ejecutar tests en secuencia
        window.addEventListener('load', () => {
            checkLocalStorage();
            checkModules();
            checkOpciones();
            createTestTurnos();
            
            // Re-cargar modules despuÃ©s de crear los turnos
            setTimeout(() => {
                finalCheck();
            }, 100);
        });
    </script>
</body>
</html>
