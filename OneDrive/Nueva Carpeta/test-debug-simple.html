<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Test Debug Simple - Verificar objetos globales</title>
    <style>
        body {
            font-family: monospace;
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid #007acc;
        }
        .ok { border-left-color: #4ec9b0; color: #4ec9b0; }
        .error { border-left-color: #f48771; color: #f48771; }
        .info { border-left-color: #9cdcfe; color: #9cdcfe; }
        h2 { color: #ce9178; }
    </style>
</head>
<body>
    <h1>üîç Test Debug - Verificaci√≥n de Objetos Globales</h1>
    <div id="output"></div>

    <!-- Cargar todos los managers y consolidados (IGUAL QUE EL HTML PRINCIPAL) -->
    <script src="js/modules.js"></script>
    <script src="js/departamentos-manager.js"></script>
    <script src="js/consolidado-departamentos.js"></script>
    <script src="js/turnos-types-manager.js"></script>
    <script src="js/consolidado-turnos.js"></script>
    <script src="js/localidades-manager.js"></script>
    <script src="js/consolidado-localidades.js"></script>
    <script src="js/sistema-reactividad.js"></script>

    <script>
        const output = document.getElementById('output');

        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `log-entry ${type}`;
            div.textContent = message;
            output.appendChild(div);
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        // Test inmediato
        log('====== VERIFICACI√ìN DE OBJETOS GLOBALES ======', 'info');
        
        const objects = [
            'DepartamentosManager',
            'ConsolidadoDepartamentos',
            'LocalidadesManager',
            'ConsolidadoLocalidades',
            'TurnosTypesManager',
            'ConsolidadoTurnos',
            'SistemaReactividad'
        ];

        objects.forEach(name => {
            const exists = typeof window[name] !== 'undefined';
            const type = exists ? 'ok' : 'error';
            log(`${exists ? '‚úÖ' : '‚ùå'} window.${name} = ${exists ? 'EXISTE' : 'NO EXISTE'}`, type);
            
            if (exists) {
                const obj = window[name];
                const methods = Object.keys(obj).filter(k => typeof obj[k] === 'function');
                log(`   ‚îî‚îÄ M√©todos (${methods.length}): ${methods.slice(0, 5).join(', ')}${methods.length > 5 ? '...' : ''}`, 'info');
            }
        });

        log('', 'info');
        log('====== VERIFICACI√ìN DE localStorage ======', 'info');
        
        const storageKeys = [
            'localidadesData',
            'tiposTurnoData',
            'departamentosData'
        ];

        storageKeys.forEach(key => {
            const data = localStorage.getItem(key);
            const exists = data !== null;
            const type = exists ? 'ok' : 'error';
            let size = '0 bytes';
            if (exists) {
                try {
                    const parsed = JSON.parse(data);
                    size = `${data.length} bytes, ${Array.isArray(parsed) ? parsed.length + ' items' : 'object'}`;
                } catch (e) {
                    size = `${data.length} bytes (INV√ÅLIDO)`;
                }
            }
            log(`${exists ? '‚úÖ' : '‚ùå'} localStorage['${key}'] = ${size}`, type);
        });

        log('', 'info');
        log('====== INTENTAR INICIALIZAR MANAGERS ======', 'info');

        // Esperamos a que se inicialicen autom√°ticamente
        setTimeout(() => {
            log('', 'info');
            log('====== VERIFICACI√ìN POSTERIOR (despu√©s de auto-inicializaci√≥n) ======', 'info');
            
            storageKeys.forEach(key => {
                const data = localStorage.getItem(key);
                const exists = data !== null;
                const type = exists && data.length > 0 ? 'ok' : 'error';
                let size = '0 bytes';
                if (exists && data.length > 0) {
                    try {
                        const parsed = JSON.parse(data);
                        size = `${data.length} bytes, ${Array.isArray(parsed) ? parsed.length + ' items' : 'object'}`;
                    } catch (e) {
                        size = `${data.length} bytes (INV√ÅLIDO)`;
                    }
                }
                log(`${exists && data.length > 0 ? '‚úÖ' : '‚ùå'} localStorage['${key}'] = ${size}`, type);
            });

            log('', 'info');
            log('====== FIN DE VERIFICACI√ìN ======', 'info');
        }, 500);
    </script>
</body>
</html>
