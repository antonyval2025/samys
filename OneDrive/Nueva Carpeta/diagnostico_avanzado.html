<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Diagn√≥stico Avanzado FASE 1</title>
    <style>
        body { font-family: Arial; margin: 20px; background: #f5f5f5; }
        .box { background: white; padding: 20px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        h2 { color: #333; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
        pre { background: #1e1e1e; color: #00ff00; padding: 15px; border-radius: 4px; overflow-x: auto; }
        .ok { color: green; font-weight: bold; }
        .err { color: red; font-weight: bold; }
        .warn { color: orange; font-weight: bold; }
        button { background: #3498db; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #2980b9; }
    </style>
</head>
<body>
    <h1>üîç Diagn√≥stico Avanzado FASE 1</h1>
    
    <div class="box">
        <h2>1. Verificaci√≥n de carga de m√≥dulos</h2>
        <div id="step1"></div>
        <button onclick="checkModuleLoading()">Ejecutar</button>
    </div>

    <div class="box">
        <h2>2. Verificar timeout y event listeners</h2>
        <div id="step2"></div>
        <button onclick="checkEventListeners()">Ejecutar</button>
    </div>

    <div class="box">
        <h2>3. Forzar inicializaci√≥n manual</h2>
        <div id="step3"></div>
        <button onclick="manualInit()">Forzar Init</button>
    </div>

    <div class="box">
        <h2>4. Verificar estado actual</h2>
        <div id="step4"></div>
        <button onclick="checkCurrentStatus()">Ejecutar</button>
    </div>

    <div class="box">
        <h2>5. Consola Capturada</h2>
        <pre id="console"></pre>
    </div>

    <script>
        let logCapturado = [];
        const logOriginal = console.log;
        console.log = function(...args) {
            logOriginal.apply(console, args);
            logCapturado.push(args.map(a => typeof a === 'object' ? JSON.stringify(a) : String(a)).join(' '));
            updateConsole();
        };

        function updateConsole() {
            document.getElementById('console').textContent = logCapturado.join('\n');
        }

        function checkModuleLoading() {
            let html = '';
            
            html += `<p><strong>document.readyState:</strong> ${document.readyState}</p>`;
            html += `<p><strong>typeof SidebarSemana3Module:</strong> <span class="${typeof SidebarSemana3Module !== 'undefined' ? 'ok' : 'err'}">${typeof SidebarSemana3Module}</span></p>`;
            html += `<p><strong>typeof ModuleManager:</strong> <span class="${typeof ModuleManager !== 'undefined' ? 'ok' : 'err'}">${typeof ModuleManager}</span></p>`;
            
            if (typeof ModuleManager !== 'undefined') {
                const mod = ModuleManager.get('SidebarSemana3Module');
                html += `<p><strong>ModuleManager.get('SidebarSemana3Module'):</strong> <span class="${mod ? 'ok' : 'err'}">${mod ? 'ENCONTRADO' : 'NO ENCONTRADO'}</span></p>`;
                if (mod) {
                    const status = mod.obtenerEstado();
                    html += `<p><strong>Estado:</strong><pre>${JSON.stringify(status, null, 2)}</pre></p>`;
                }
            }
            
            document.getElementById('step1').innerHTML = html;
        }

        function checkEventListeners() {
            let html = '<p>Informaci√≥n sobre listeners:</p>';
            html += `<ul>`;
            html += `<li>DOMContentLoaded evento: Ya ${document.readyState === 'loading' ? 'NO ha disparado' : 'HA disparado'}</li>`;
            html += `<li>Si readyState !== 'loading', el evento DOMContentLoaded ya pas√≥</li>`;
            html += `<li>Si readyState === 'loading', estamos esperando que dispare</li>`;
            html += `</ul>`;
            
            html += '<p><strong>Soluci√≥n:</strong> Si readyState !== "loading", el timeout deber√≠a haber ejecutado init() autom√°ticamente.</p>';
            
            document.getElementById('step2').innerHTML = html;
        }

        function manualInit() {
            let html = '';
            try {
                if (typeof SidebarSemana3Module === 'undefined') {
                    html += '<span class="err">‚ùå SidebarSemana3Module no est√° definido</span>';
                } else {
                    console.log('Llamando a SidebarSemana3Module.init()...');
                    SidebarSemana3Module.init();
                    const status = SidebarSemana3Module.obtenerEstado();
                    html += `<span class="ok">‚úÖ init() llamado exitosamente</span>`;
                    html += `<pre>${JSON.stringify(status, null, 2)}</pre>`;
                }
            } catch (e) {
                html += `<span class="err">‚ùå Error: ${e.message}</span>`;
            }
            document.getElementById('step3').innerHTML = html;
        }

        function checkCurrentStatus() {
            let html = '';
            try {
                const mod = ModuleManager.get('SidebarSemana3Module');
                if (!mod) {
                    html += '<span class="err">‚ùå M√≥dulo no encontrado en ModuleManager</span>';
                } else {
                    const status = mod.obtenerEstado();
                    const deps = mod.validarDependencias();
                    
                    html += `<h3>Estado del M√≥dulo</h3>`;
                    html += `<pre>${JSON.stringify(status, null, 2)}</pre>`;
                    
                    html += `<h3>Dependencias</h3>`;
                    html += `<pre>${JSON.stringify(deps, null, 2)}</pre>`;
                    
                    html += `<h3>Resumen</h3>`;
                    html += `<ul>`;
                    html += `<li>isInitialized: <span class="${status.isInitialized ? 'ok' : 'err'}">${status.isInitialized ? '‚úÖ' : '‚ùå'}</span></li>`;
                    const depsMissing = Object.values(deps).filter(v => !v).length;
                    html += `<li>Dependencias disponibles: <span class="${depsMissing === 0 ? 'ok' : 'warn'}">${Object.values(deps).filter(v => v).length}/${Object.keys(deps).length}</span></li>`;
                    html += `</ul>`;
                }
            } catch (e) {
                html += `<span class="err">‚ùå Error: ${e.message}</span>`;
            }
            document.getElementById('step4').innerHTML = html;
        }

        // Ejecutar autom√°ticamente al cargar
        window.addEventListener('load', function() {
            console.log('Load event disparado, ejecutando verificaciones...');
            setTimeout(() => {
                checkModuleLoading();
                checkEventListeners();
                checkCurrentStatus();
            }, 500);
        });
    </script>
</body>
</html>
